@page
@model GiSanParkGolf.Pages.AdminPage.GameSetupModel
@{
    ViewData["Title"] = "인원 코스 및 배치";
}

@await Html.PartialAsync("Shared/Components/_HeaderCard",(ViewData["Title"] as string ?? "제목 없음"
    , "대회를 선택한 후, 배치 옵션을 설정하고 인원을 코스에 배치할 수 있습니다."))

<div class="container mt-2">
    <!-- 대회 선택 패널(항상 보임) -->
    <div id="topPanel" class="mb-4">
        <div class="custom-card p-3 shadow-sm">
            <h4 class="card-title">대회 선택</h4>
            <p class="mb-2 text-muted">대회명을 클릭하여 세부정보를 확인하세요.</p>
            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0" id="gameTable">
                    <thead class="table-light">
                        <tr>
                            <th style="width:4rem">No</th>
                            <th>대회명</th>
                            <th>대회일자</th>
                            <th>선택</th>
                        </tr>
                    </thead>
                    <tbody>
                        @for (int i = 1; i <= 5; i++)
                        {
                            <tr>
                                <td>@i</td>
                                <td>파크골프대회 @i</td>
                                <td>2025-09-0@i</td>
                                <td>
                                    <button class="btn btn-outline-primary btn-sm select-game-btn"
                                            data-gamename="파크골프대회 @i"
                                            data-gamedate="2025-09-0@i"
                                            data-status="진행중"
                                            data-unassigned="2"
                                            data-total="32"
                                            data-cancel="3"
                                            data-wait="4"
                                            data-todaycancel="2"
                                            data-notice="오늘 15시 경기장 집합">
                                        선택
                                    </button>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- 아래는 대회 선택시만 표시 -->
    <div id="selectedPanels" style="display:none;">
        <!-- 상태바/대시보드 -->
        <div id="statusBarArea"></div>
        <div id="dashboardArea"></div>

        <!-- 상세/탭/배치 패널 -->
        <div id="bottomPanel">
            <div class="custom-card p-3 shadow-sm">
                <div class="mb-3 d-flex align-items-center">
                    <h4 class="card-title mb-0 flex-grow-1">대회 상세정보</h4>
                    <button class="btn btn-outline-success btn-sm" id="backToListBtn">목록으로 이동</button>
                </div>
                <!-- 탭 메뉴 (기본 틀만) -->
                <ul class="nav nav-tabs mb-3" id="gameSetupTabs" role="tablist">
                    <li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#tab-info" role="tab">기본정보</a></li>
                    <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#tab-player" role="tab">참가자확인</a></li>
                    <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#tab-course" role="tab">코스배치</a></li>
                    <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#tab-result" role="tab">코스배치 결과 확인</a></li>
                </ul>
                <div class="tab-content">
                    <div class="tab-pane fade show active" id="tab-info" role="tabpanel">
                        <div class="p-3 bg-light rounded">
                            <b id="infoName">파크골프대회</b><br>
                            <span id="infoDate">2025-09-01</span> /
                            <span id="infoStatus">진행중</span> /
                            <span id="infoTotal">32명 참가</span>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="tab-player" role="tabpanel">
                        <div class="p-3">[참가자 확인 영역]</div>
                    </div>
                    <div class="tab-pane fade" id="tab-course" role="tabpanel">
                        <div class="p-3">[코스 배치 영역]</div>
                    </div>
                    <div class="tab-pane fade" id="tab-result" role="tabpanel">
                        <div class="p-3">[코스배치 결과 확인 영역]</div>
                    </div>
                </div>
                <div id="faq" class="mt-4">
                    <div class="card card-body bg-light border-0">
                        <h6><i class="bi bi-question-circle me-1"></i>도움말 & 문의</h6>
                        <ul class="mb-1">
                            <li>대회명을 클릭하거나 [선택]을 누르면 상세정보가 보입니다.</li>
                            <li>기타 문의는 관리자에게 연락하세요.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // 대회 선택/해제 토글 - 기본틀 버전
    document.addEventListener('DOMContentLoaded', function () {
        const bottomPanel = document.getElementById('selectedPanels');
        const topPanel = document.getElementById('topPanel');
        const selectButtons = document.querySelectorAll('.select-game-btn');
        const statusBarArea = document.getElementById('statusBarArea');
        const dashboardArea = document.getElementById('dashboardArea');
        // 대회 상세정보 영역
        function fillGameInfo(attrs) {
            document.getElementById('infoName').textContent = attrs.gamename || '파크골프대회';
            document.getElementById('infoDate').textContent = attrs.gamedate || '2025-09-01';
            document.getElementById('infoStatus').textContent = attrs.status || '진행중';
            document.getElementById('infoTotal').textContent = (attrs.total || '32') + '명 참가';
        }
        selectButtons.forEach(btn => {
            btn.addEventListener('click', function () {
                const attrs = {
                    gamename: btn.getAttribute('data-gamename'),
                    gamedate: btn.getAttribute('data-gamedate'),
                    status: btn.getAttribute('data-status'),
                    unassigned: btn.getAttribute('data-unassigned'),
                    total: btn.getAttribute('data-total'),
                    cancel: btn.getAttribute('data-cancel'),
                    wait: btn.getAttribute('data-wait'),
                    todaycancel: btn.getAttribute('data-todaycancel'),
                    notice: btn.getAttribute('data-notice')
                };
                // 상태바/대시보드 채우기(더미)
                statusBarArea.innerHTML = `
                    <div class="alert alert-primary shadow-sm mb-3">
                        현재 대회: <b>${attrs.gamename}</b> | 상태: <span class="text-success">${attrs.status}</span> | 일자: ${attrs.gamedate}
                        <span class="badge bg-danger ms-3">미배정 ${attrs.unassigned}명</span>
                        <span class="ms-3"><i class="bi bi-bell-fill text-warning"></i> 공지: ${attrs.notice}</span>
                    </div>
                `;
                dashboardArea.innerHTML = `
                    <div class="container mb-3">
                        <div class="row g-2">
                            <div class="col-6 col-md-3">
                                <div class="card text-center border-0 shadow-sm">
                                    <div class="card-body">
                                        <div class="h3 mb-0">${attrs.total}</div>
                                        <div class="small text-muted">총 참가자</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6 col-md-3">
                                <div class="card text-center border-0 shadow-sm">
                                    <div class="card-body">
                                        <div class="h3 mb-0 text-danger">${attrs.unassigned}</div>
                                        <div class="small text-muted">미배정</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6 col-md-3">
                                <div class="card text-center border-0 shadow-sm">
                                    <div class="card-body">
                                        <div class="h3 mb-0">${attrs.todaycancel}</div>
                                        <div class="small text-muted">참가취소 요청</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6 col-md-3">
                                <div class="card text-center border-0 shadow-sm">
                                    <div class="card-body">
                                        <div class="h3 mb-0">${attrs.wait}</div>
                                        <div class="small text-muted">배정 대기</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                fillGameInfo(attrs);
                bottomPanel.style.display = '';
                topPanel.style.display = 'none';
                window.scrollTo({ top: 0, behavior: "smooth" });
            });
        });
        // 목록으로 이동(다시 대회선택창 보이기)
        document.getElementById('backToListBtn').addEventListener('click', function () {
            bottomPanel.style.display = 'none';
            topPanel.style.display = '';
            statusBarArea.innerHTML = '';
            dashboardArea.innerHTML = '';
        });
    });
</script>